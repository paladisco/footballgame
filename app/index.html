<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <!-- build:remove -->
    <title>rf14</title>
    <!-- /build -->
    include "include/head.html"
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css /styles/vendor.css -->
    <!-- bower:css -->
    <link rel="stylesheet" href="bower_components/sass-bootstrap/dist/css/bootstrap.css" />
    <!-- endbower -->
    <link rel="stylesheet" href="bower_components/flat-ui-official/css/flat-ui.css" />
    <!-- endbuild -->
    <!-- build:css(.tmp) /styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
    <!-- build:js /scripts/vendor/modernizr.js -->
    <script src="bower_components/modernizr/modernizr.js"></script>
    <!-- endbuild -->

    <!-- build:js /scripts/vendor.js -->
    <!-- bower:js -->
    <script src="bower_components/jquery/jquery.js"></script>
    <script src="bower_components/jquery-ui/ui/jquery-ui.js"></script>
    <script src="bower_components/sass-bootstrap/dist/js/bootstrap.js"></script>
    <script src="bower_components/typeahead.js/dist/typeahead.bundle.js"></script>
    <script src="scripts/vendor/jquery.path.js"></script>
    <!-- endbower -->
    <!-- endbuild -->
</head>
<body>
    <!--[if lt IE 10]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    include "include/navigation.html"

    <div>
        <div class="main">

            include "include/heading.html"

            <!-- zend:layout content -->
            <!-- build:remove -->


                        <div class="row" id="match">
                <div class="col-lg-6">
                    <div class="row">
                        <a class="pull-right btn btn-danger btn-small" id="actionButton" href="/game/match/index/away_team_id/3/reset/1">
                            <i class="fa fa-refresh"></i> Reset Match
                        </a>
                        <div class="col-lg-6">
                            <div class="controls" id="matchControls">            <a class="btn btn-primary actionButton" data-loading-text="attempting..." data-instruction="dribble" style="display: none;">
                        Dribble on!
                    </a>
                    <a class="btn btn-primary actionButton skillModified" data-skill="accuracy" data-loading-text="attempting..." data-instruction="pass" style="display: none;">
                    Pass the ball!
                </a>
                    </div>
                            <div id="skillContainer"><a class="btn hit btn-primary pull-left">Hit it!</a><div class="progress accuracy"><div class="progress-bar gauge" style="width: 0%;"></div></div></div>
                        </div>
                        <div class="col-lg-6">

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <h4 style="text-align: right;"><span class="label label-success">Diego Paladino FC</span></h4>
                        </div>
                        <div class="col-lg-6">
                            <h4><span class="label label-danger">Sharky Racerfish FC</span></h4>
                        </div>
                        <div id="summary"><div class="row">
                <div class="col-lg-12 score">
                    0 : 0    </div>
            </div>
            <div class="summary">
                </div></div>
                    </div>
                    <div id="matchLog">
                        <div class="log"><div class="row" style="">
                    <div class="alert alert-info col-lg-6 left">
                    <div class="minute">9'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/517233293/picture"></div>        <div class="message element ">Daniel Ritschard dribbles around with the ball, as Stephan Groth goes in for a tackling and wins posession!</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 col-lg-offset-6 right">
                    <div class="minute">8'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/578962187/picture"></div>        <div class="message element ">Rimini W. Frosch dribbles around with the ball, as Daniel Ritschard goes in for a tackling and wins posession!</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 left">
                    <div class="minute">7'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/527649474/picture"></div>        <div class="message element ">Rimini W. Frosch dribbles around with the ball and skillfully moves the ball forward!</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 left">
                    <div class="minute">6'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/527649474/picture"></div>        <div class="message element ">Daniel Ritschard loses possession, Rimini W. Frosch has got the ball now.</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 col-lg-offset-6 right">
                    <div class="minute">5'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/578962187/picture"></div>        <div class="message element ">Sandra Defant passes the ball to Daniel Ritschard, who successfully claims the ball.</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 col-lg-offset-6 right">
                    <div class="minute">4'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/1051093481/picture"></div>        <div class="message element "> to Sandra Defant, who successfully claims the ball.</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 col-lg-offset-6 right">
                    <div class="minute">4'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/687072264/picture"></div>        <div class="message element ">Stefan Tobler brings the ball back into play.</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 col-lg-offset-6 right">
                    <div class="minute">3'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/687072264/picture"></div>        <div class="message element ">It comes for a goal kick!</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 left">
                    <div class="minute">3'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/643953604/picture"></div>        <div class="message element ">Petar Arapovic completely misses the Target. What a waster!</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 left">
                    <div class="minute">3'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/643953604/picture"></div>        <div class="message element ">Petar Arapovic takes aim and shoots...</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 left">
                    <div class="minute">2'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/643953604/picture"></div>        <div class="message element ">Noemi Scheps passes the ball to Petar Arapovic, who successfully claims the ball.</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 left">
                    <div class="minute">1'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/573679960/picture"></div>        <div class="message element ">Meinhard Meintjes dribbles around with the ball, as Noemi Scheps goes in for a tackling and wins posession!</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 col-lg-offset-6 right">
                    <div class="minute">0'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->        <div class="player element"><img class="thumbnail" src="http://graph.facebook.com/608681917/picture"></div>        <div class="message element ">Sharky Racerfish FC kicks off. Meinhard Meintjes is on the ball.</div>
                </div>
            </div><div class="row" style="">
                    <div class="alert alert-info col-lg-6 col-lg-offset-6 right">
                    <div class="minute">0'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->                <div class="message element ">Sharky Racerfish FC wins the Coin Toss!</div>
                </div>
            </div>
                <div class="row">
                    <div class="info alert alert-info col-lg-6 col-lg-offset-3 middle">
                    <div class="minute">0'</div>
            <!--        --><!--<div class="team element"><img src="--><!--" /></div>-->                <div class="message element ">Match is about to start!</div>
                </div>
            </div></div>        </div>
                </div>
                <div class="col-lg-6">
                            <div id="pitch" class="pitch">
                        <div class="ball" style="top: 90%; left: 56%;"></div>
            <div class="player" style="top: 91%; left: 54%;"><img class="thumbnail" src="http://graph.facebook.com/517233293/picture"></div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="skillgameModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;"></div><!-- /.modal -->

            <script>
            $(document).ready(function () {
                $('.skillContainer').hide();
                initControls();
            });

            function initControls(){
                $('#matchControls .actionButton').click(function(){
                    var button = $(this);
                    var instruction = button.data('instruction');
                    var skill = button.data('skill');
                    //button.button('loading');
                    $('#matchControls .actionButton').hide();

                    if (instruction=='shoot'){
                        // Hook Shooting Skillgame
                        initSkillModifier(instruction, skill, function(instruction,skill){
                            $('#skillgameModal').modal({
                                remote: "/game/match/skillgame/away_team_id/3/skill/"+skill
                            });
                        });
                    }
                    else if (button.hasClass('skillModified')) {
                        initSkillModifier(instruction, skill, loadGameAction);
                    } else {
                        loadGameAction(instruction);
                    }

                });
            }

            function animateGauge(container,skill){
                var width = parseInt(container.css('width'));
                var parentWidth = parseInt(container.parent().css('width'));
                if(skill=='power'){
                    if (width < 10) {
                        container.css('width', '100%');
                    } else {
                        container.css('width', '0%');
                    }
                }else if(skill=='accuracy'){
                    if (width < 10) {
                        container.css('width', '100%');
                    } else {
                        container.css('width', '0%');
                    }
                }
            }
            function initSkillModifier(instruction, skill, callback) {

                var progress = document.createElement('div');
                $(progress).addClass('progress '+skill);

                var progressBar = document.createElement('div');
                $(progressBar).addClass('progress-bar gauge');
                $(progressBar).css('width','50%');

                var hitButton = document.createElement('a');
                $(hitButton).addClass('btn hit btn-primary pull-left');
                $(hitButton).html('Hit it!');

                $(progressBar).appendTo($(progress));
                $(hitButton).appendTo($('#skillContainer'));
                $(progress).appendTo($('#skillContainer'));

                animateGauge($(progressBar),skill);
                var gaugeInterval = setInterval(function () {
                    animateGauge($(progressBar),skill);
                }, parseFloat($(progressBar).css('transition-duration')) * 1100);

                $(hitButton).click(function(){
                    clearInterval(gaugeInterval);
                    $(progressBar).css('width',$(progressBar).css('width'));
                    callback(instruction, skill);
                })
            };

            function loadEvent(data,i) {
                if (data.html[++i]) {
                    $('#matchLog .log').prepend(data.html[i]);
                    $('#matchLog .log .row:first').slideDown(300, function () {

                        $('.pitch .ball').animate({
                            'left': data.log[i].ball.x + '%',
                            'top': data.log[i].ball.y + '%'
                        }, 500, "linear");

                        if (data.log[i].player_pic) {
                            $('#pitch .player').html('');
                            if (data.log[i].side == 1) {
                                $('#pitch .player').css('left', (data.log[i].ball.x - 2) + '%');
                                $('#pitch .player').css('top', data.log[i].ball.y + 1 + '%');
                            } else if (data.log[i].side == 2) {
                                $('#pitch .player').css('left', (data.log[i].ball.x + 2) + '%');
                                $('#pitch .player').css('top', data.log[i].ball.y + 1 + '%');
                            }
                            var img = $('<img />'); //Equivalent: $(document.createElement('img'))
                            img.attr('class', 'thumbnail');
                            img.attr('src', data.log[i].player_pic);
                            $('#pitch .player').html(img);
                        }

                        setTimeout(function(){
                            loadEvent(data,i);
                        }, 500);
                    });
                } else {
                    $('#matchControls').html(data.controls);
                    initControls();
                }
            }

            function loadGameAction(instruction, skill, callback) {

                var skillModifier = 0;
                if(typeof skill !== 'undefined'){
                    var pct = (parseInt($('#skillContainer').find('.gauge').css('width')) / parseInt($('#skillContainer').find('.gauge').parent().css('width')))*100;
                    if(skill=='power'){
                        skillModifier = pct;
                    }else{
                        skillModifier = (50-Math.abs(50-pct))*2;
                        console.log(skillModifier);
                    }
                    $('#skillContainer').html('');
                }

                $.ajax({
                    url: "/game/match/play/away_team_id/3",
                    data: {
                        'instruction': instruction,
                        'skill': skillModifier
                    }
                }).done(function (jsonData) {
                    data = $.parseJSON(jsonData);

                    if(typeof callback !== 'undefined'){
                        for(var j=0;j<data.log.length;j++){
                            if(data.log[j].action!=null){
                                callback(data.log[j].action);
                            }
                        }
                        setTimeout(function () {
                            $('#skillgameModal').modal('hide');
                            $('#skillgameModal').removeData('bs.modal')
                            loadEvent(data,-1);
                        }, 1500);
                    }else{
                        loadEvent(data,-1);
                    }

                    $('#summary').html(data.summary);
                });
            }
            </script>
            <!-- /build -->
        </div>
    </div>

    include "include/footer.html"

    <div class="modal fade" id="eventModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
    <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-XXXXX-X');ga('send','pageview');
    </script>

    <!-- build:js({app,.tmp}) /scripts/main.js -->
    <script src="scripts/main.js"></script>
    <!-- endbuild -->
</body>
</html>
